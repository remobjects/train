---
title: S3
---

Upload and download files to Amazon S3. S3 is AWS's object storage service - commonly used for build artifacts, packages, and backups.

## Quick Reference

* **new S3()** - Create S3 client instance
* **s3.upload(localFile, remotePath)** - Upload file to S3
* **s3.download(remotePath, localFile)** - Download file from S3
* **s3.list(prefix)** - List objects in bucket
* **s3.remove(remotePath)** - Delete object from S3

## Setup

To use S3, create an S3 instance and configure credentials:

```javascript
// Create S3 client
var s3 = new S3();
s3.accessKeyID = "AKIA...";           // AWS access key
s3.secretAccessKey = "secret...";     // AWS secret key
s3.bucket = "my-bucket";              // S3 bucket name

// Optional: specify region
s3.regionEndpoint = "us-west-2";      // AWS region (optional)
```

### Configuration Properties

**bucket** (required) - S3 bucket name
- Must exist and you must have access

**accessKeyID** (required) - AWS access key ID
- Get from AWS IAM console or environment variables

**secretAccessKey** (required) - AWS secret access key
- Keep secure, use environment variables in CI

**regionEndpoint** (optional) - AWS region
- E.g., "us-east-1", "eu-west-1", "ap-southeast-1"
- Defaults to us-east-1 if not specified

**serviceURL** (optional) - Custom S3-compatible service endpoint
- For S3-compatible services (Minio, DigitalOcean Spaces, etc.)

## Uploading Files

### s3.uploadFile(localFile, key)

Uploads a single file to S3.

```javascript
// Upload file
s3.uploadFile("./release.zip", "releases/v1.0/release.zip");

// Upload with variables
var version = "1.0.0";
s3.uploadFile("./Bin/app.exe", "builds/v" + version + "/app.exe");

// Use prefix (folder-like structure)
export("keyPrefix", "releases/v2.5");
s3.uploadFile("package.zip", "$(keyPrefix)/package.zip");
```

The **key** is the full path/name for the file in S3. S3 doesn't have true folders, but uses `/` in keys to organize files.

### s3.uploadFiles(localFolderAndFilters, prefix, recurse)

Uploads multiple files to S3.

**Parameters:**
- `localFolderAndFilters` - Local directory path, optionally with wildcards (`*`, `?`)
- `prefix` - S3 key prefix (folder path) where files will be uploaded
- `recurse` - If true, upload files in subdirectories recursively

```javascript
// Upload all files in folder
s3.uploadFiles("./Bin/Release", "builds/latest/", false);

// Upload with file pattern
s3.uploadFiles("./Bin/*.dll", "libraries/", false);

// Upload recursively
s3.uploadFiles("./Docs", "documentation/v1.0/", true);
```

## Downloading Files

### s3.downloadFile(key, localTarget)

Downloads a single file from S3.

**Parameters:**
- `key` - S3 key (path) of the file
- `localTarget` - Local destination. If ends with `/`, treated as folder (filename from key). Otherwise, full file path.

```javascript
// Download to specific file
s3.downloadFile("releases/v1.0/package.zip", "./downloads/package.zip");

// Download to folder (filename from key)
s3.downloadFile("releases/v1.0/package.zip", "./downloads/");
// Creates: ./downloads/package.zip

// Use variables
var version = "2.5.0";
s3.downloadFile("packages/v" + version + "/sdk.zip", "./temp/");
```

### s3.downloadFiles(prefix, suffix, localTargetDir, recurse)

Downloads multiple files matching a prefix and suffix.

**Parameters:**
- `prefix` - S3 key prefix (folder path) to search
- `suffix` - File extension or suffix to match (e.g., ".zip", ".dll")
- `localTargetDir` - Local directory for downloaded files
- `recurse` - If true, download from subdirectories recursively

```javascript
// Download all ZIP files from prefix
s3.downloadFiles("releases/v1.0/", ".zip", "./downloads/", false);

// Download recursively
s3.downloadFiles("libraries/", ".dll", "./libs/", true);

// Download all files (empty suffix)
s3.downloadFiles("shared/", "", "./shared/", false);
```

## Reading and Writing Text

### s3.readFile(key)

Downloads a file from S3 and returns its content as a string.

```javascript
// Read text file from S3
var timestamp = s3.readFile("shared/TIMESTAMP.TXT");
log("Last update: " + timestamp);

// Read version file
var version = s3.readFile("config/VERSION").trim();
```

### s3.writeFile(content, key)

Uploads string content as a file to S3.

```javascript
// Write text file
s3.writeFile("Build completed at " + new Date(), "logs/latest.txt");

// Write marker file
s3.writeFile("x", "$(keyPrefix)/marker.txt");

// Write version info
var version = "2.5.0";
s3.writeFile(version, "releases/latest/VERSION");
```

## Listing Files

### s3.listFiles(prefix, suffix, recurse)

Returns an array of S3 keys matching the prefix and suffix.

**Parameters:**
- `prefix` - S3 key prefix (folder path) to search
- `suffix` - File extension or suffix filter (empty for all)
- `recurse` - If true, list files in subdirectories recursively

```javascript
// List all files in prefix
var files = s3.listFiles("releases/", "", false);
for (var i = 0; i < files.length; i++) {
  log("File: " + files[i]);
}

// List ZIP files
var zips = s3.listFiles("packages/", ".zip", false);

// List recursively
var allFiles = s3.listFiles("builds/", "", true);

// Check if file exists
var folders = s3.listFiles("repository/", "", false);
if (folders.indexOf("master") >= 0) {
  log("Master branch folder exists");
}
```

When `recurse` is false, the list includes files at the first level plus folder prefixes of any nested files.

## Examples

### CI Build Artifact Upload

```javascript
// Get credentials from environment
var s3 = new S3();
s3.accessKeyID = env["AWS_ACCESS_KEY_ID"];
s3.secretAccessKey = env["AWS_SECRET_ACCESS_KEY"];
s3.bucket = "my-ci-builds";

// Upload build artifacts
var version = env["CI_VERSION"] || "1.0.0";
var branch = env["CI_BRANCH"] || "main";
var commit = env["CI_COMMIT_HASH"] || "unknown";

var prefix = "builds/" + branch + "/" + commit + "/";

log("Uploading to S3: " + prefix);

s3.uploadFiles("./Bin/Release/*.exe", prefix, false);
s3.uploadFiles("./Bin/Release/*.dll", prefix, false);

// Write metadata
s3.writeFile(version, prefix + "VERSION");
s3.writeFile(new Date().toISOString(), prefix + "TIMESTAMP");

log("Upload complete");
```

### Download Latest Release

```javascript
var s3 = new S3();
s3.accessKeyID = env["AWS_ACCESS_KEY_ID"];
s3.secretAccessKey = env["AWS_SECRET_ACCESS_KEY"];
s3.bucket = "releases";

// Read latest version
var latestVersion = s3.readFile("latest/VERSION").trim();
log("Latest version: " + latestVersion);

// Download release package
folder.create("./downloads");
s3.downloadFile("v" + latestVersion + "/package.zip", "./downloads/");

// Extract
zip.extractFiles("./downloads/package.zip", "./release/");

log("Downloaded and extracted version " + latestVersion);
```

### Shared Package Management

Create reusable function for accessing shared S3 bucket:

```javascript
function getSharedS3Bucket() {
  var s3 = new S3();
  s3.accessKeyID = env["CIS3AccessKeyID"];
  s3.secretAccessKey = env["CIS3SecretAccessKey"];
  s3.bucket = env["CISharedS3Bucket"];
  return s3;
}

// Use in build script
var s3 = getSharedS3Bucket();
s3.downloadFiles("libraries/v2.5/", ".dll", "./libs/", false);
```

### Timestamped Uploads

```javascript
function uploadWithTimestamp(s3, bucket, prefix) {
  var timestamp = new Date().toISOString();
  s3.writeFile(timestamp, prefix + "TIMESTAMP.TXT");
  log("Uploaded timestamp: " + timestamp);
}

var s3 = new S3();
s3.accessKeyID = env["AWS_ACCESS_KEY_ID"];
s3.secretAccessKey = env["AWS_SECRET_ACCESS_KEY"];
s3.bucket = "my-bucket";

// Upload files
s3.uploadFiles("./Bin/Release", "builds/latest/", true);

// Add timestamp
uploadWithTimestamp(s3, "my-bucket", "builds/latest/");
```

### Multi-Architecture Releases

```javascript
var s3 = new S3();
s3.accessKeyID = env["AWS_ACCESS_KEY_ID"];
s3.secretAccessKey = env["AWS_SECRET_ACCESS_KEY"];
s3.bucket = "releases";

var version = "2.0.0";
var architectures = ["x86", "x64", "arm64"];

for (var i = 0; i < architectures.length; i++) {
  var arch = architectures[i];
  log("Uploading " + arch + " release");

  var buildDir = "./Bin/Release/" + arch;
  var prefix = "v" + version + "/" + arch + "/";

  s3.uploadFiles(buildDir, prefix, true);
}

// Update latest version marker
s3.writeFile(version, "latest/VERSION");

log("All architectures uploaded");
```

### Clean Old Builds

```javascript
var s3 = new S3();
s3.accessKeyID = env["AWS_ACCESS_KEY_ID"];
s3.secretAccessKey = env["AWS_SECRET_ACCESS_KEY"];
s3.bucket = "ci-builds";

// List all build folders
var builds = s3.listFiles("builds/", "", false);

log("Found " + builds.length + " build folders");
// Note: S3 object doesn't expose delete methods in Train,
// so you'd need to use AWS CLI or web console for cleanup
```

## Related Documentation

- [HTTP](HTTP.md) - Download files from web
- [Zip](Zip.md) - Compress/extract archives
- [File](File.md) - File operations
- [Folder](Folder.md) - Directory operations
